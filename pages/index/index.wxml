<!--pages/index/index.wxml-->
<view class="container">
  <!-- æ˜¾ç¤ºæ¨¡å¼ï¼šå®Œæ•´åŠŸèƒ½ -->
  <block wx:if="{{showFortunePage}}">
    <view class="header">
      <text class="title">{{appTitle}}</text>
      <!-- æŸ¥çœ‹æŠ¥å‘Šå…¥å£ -->
      <view class="history-entry" bindtap="onGoHistory">
        <text class="history-icon">ğŸ“‹</text>
        <text class="history-text">æŸ¥çœ‹æŠ¥å‘Š</text>
      </view>
    </view>

    <form class="form" bindsubmit="onSubmit">
    <!-- å§“å -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        <text>å§“å</text>
      </view>
      <input
        class="input"
        name="name"
        value="{{formData.name}}"
        placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
        bindinput="onNameInput"
        maxlength="10"
      />
    </view>

    <!-- æ€§åˆ«ï¼ˆå•é€‰æ¡†ï¼‰ -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        <text>æ€§åˆ«</text>
      </view>
      <radio-group class="gender-group" bindchange="onGenderChange">
        <label class="gender-item" wx:for="{{genderOptions}}" wx:key="index">
          <radio value="{{index}}" checked="{{formData.genderIndex === index}}" color="#667eea"/>
          <text class="gender-text">{{item}}</text>
        </label>
      </radio-group>
    </view>

    <!-- å‡ºç”Ÿæ—¥æœŸ -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        <text>å‡ºç”Ÿæ—¥æœŸ</text>
      </view>
      <picker
        class="picker"
        mode="date"
        value="{{formData.birthDate}}"
        start="1900-01-01"
        end="{{todayDate}}"
        bindchange="onBirthDateChange"
      >
        <view class="picker-value {{formData.birthDate ? '' : 'placeholder'}}">
          {{formData.birthDate || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}
        </view>
      </picker>
    </view>

    <!-- å‡ºç”Ÿæ—¶é—´ -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        <text>å‡ºç”Ÿæ—¶é—´</text>
      </view>
      <picker
        class="picker"
        mode="time"
        value="{{formData.birthTime}}"
        bindchange="onBirthTimeChange"
      >
        <view class="picker-value {{formData.birthTime ? '' : 'placeholder'}}">
          {{formData.birthTime || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´'}}
        </view>
      </picker>
    </view>

    <!-- å‡ºç”ŸåŸå¸‚ï¼ˆå¸¦æœç´¢ï¼‰ -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        <text>å‡ºç”ŸåŸå¸‚</text>
      </view>
      <view class="city-selector">
        <input
          class="input"
          name="city"
          value="{{formData.city}}"
          placeholder="åŒ—äº¬"
          bindinput="onCityInput"
          bindfocus="onCityFocus"
        />
        <view class="city-dropdown" wx:if="{{showCityDropdown && filteredCities.length > 0}}">
          <view
            class="city-option"
            wx:for="{{filteredCities}}"
            wx:key="*this"
            bindtap="onSelectCity"
            data-city="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>
    </view>

    <!-- å…‘æ¢ç ï¼ˆæ ¹æ®é…ç½®æ˜¾ç¤º/éšè—ï¼‰ -->
    <view class="form-item" wx:if="{{showVoucherCode}}">
      <view class="label">
        <text>å…‘æ¢ç ï¼ˆå¯é€‰ï¼‰</text>
      </view>
      <view class="hint-text">å¦‚æœ‰å…‘æ¢ç ï¼Œè¯·å¡«å†™ä»¥æ¿€æ´»æŠ¥å‘Šç”Ÿæˆ</view>
      <input
        class="input"
        name="voucherCode"
        value="{{formData.voucherCode}}"
        placeholder="è¯·è¾“å…¥30ä½å…‘æ¢ç "
        bindinput="onVoucherCodeInput"
        maxlength="30"
      />
    </view>

    <!-- æäº¤æŒ‰é’®åŒºåŸŸ(åŠ¨æ€å¸ƒå±€) -->
    <view
      wx:if="{{showBasicReportButton || showFortune2026Button}}"
      class="button-container {{showBasicReportButton && showFortune2026Button ? 'dual-buttons' : 'single-button'}}"
    >
      <!-- åŸºç¡€æŠ¥å‘ŠæŒ‰é’® -->
      <button
        wx:if="{{showBasicReportButton}}"
        class="submit-btn {{showBasicReportButton && showFortune2026Button ? 'half-width' : 'full-width'}}"
        formType="submit"
        loading="{{submitting}}"
        disabled="{{submitting || submittingFortune2026}}"
      >
        {{submitting ? 'æäº¤ä¸­...' : submitButtonText}}
      </button>

      <!-- 2026è¿åŠ¿æŒ‰é’® -->
      <button
        wx:if="{{showFortune2026Button}}"
        class="submit-btn {{showBasicReportButton && showFortune2026Button ? 'half-width' : 'full-width'}}"
        bindtap="onSubmitFortune2026"
        loading="{{submittingFortune2026}}"
        disabled="{{submitting || submittingFortune2026}}"
      >
        {{submittingFortune2026 ? 'æäº¤ä¸­...' : fortune2026ButtonText}}
      </button>
    </view>
  </form>

    <!-- å…è´£å£°æ˜ -->
    <view class="disclaimer">
      <text>æœ¬æµ‹ç®—ä»…ä¾›å¨±ä¹å‚è€ƒï¼Œä¸æ„æˆä¸“ä¸šå»ºè®®</text>
    </view>

    <!-- å…¨å±åŠ è½½é®ç½© -->
    <view wx:if="{{submitting}}" class="loading-overlay">
      <view class="loading-content">
        <view class="loading-spinner"></view>
        <text class="loading-text">æäº¤ä¸­...</text>
      </view>
    </view>
  </block>

  <!-- ä¸æ˜¾ç¤ºæ¨¡å¼ï¼šæç¤ºæ–‡æ¡ˆ -->
  <view wx:else class="feature-unavailable">
    <text class="unavailable-text">è¯¥åŠŸèƒ½å°šæœªå¼€å‘</text>
  </view>
</view>
