<!--pages/calendar/calendar.wxml-->
<view class="calendar-container" bindtouchstart="onTouchStart" bindtouchend="onTouchEnd">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-left">
      <text class="lantern-icon">ğŸ®</text>
      <text class="title">ä¸‡å¹´å†</text>
    </view>
    <view class="header-right">
      <view wx:if="{{!isToday}}" class="today-btn-top" bindtap="goToToday">
        <text>å›åˆ°ä»Šå¤©</text>
      </view>
      <view class="calendar-icon" bindtap="onCalendarIconClick">
        <text class="icon">ğŸ“…</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é»„å†å†…å®¹ -->
  <view wx:else class="content">
    <!-- æ—¥æœŸä¸»ä¿¡æ¯åŒº -->
    <view class="date-section">
      <view class="date-left">
        <view class="solar-date">{{calendarData.solar.year}}å¹´{{calendarData.solar.month}}æœˆ{{calendarData.solar.day}}æ—¥ æ˜ŸæœŸ{{calendarData.solar.weekday}}</view>
        <view class="lunar-date">{{calendarData.lunar.monthDay}}</view>
        <view class="tags">
          <text class="tag tag-zodiac">å±{{calendarData.lunar.zodiac}}</text>
          <text class="tag tag-week">ç¬¬ {{calendarData.solar.week}} å‘¨</text>
          <text wx:if="{{calendarData.jieQiTag}}" class="tag tag-jieqi">{{calendarData.jieQiTag.name}}</text>
        </view>
      </view>
      <view class="date-right">
        <text class="icon-prev" bindtap="onPrevDay">â€¹</text>
        <text class="day-number">{{calendarData.solar.day}}</text>
        <text class="icon-next" bindtap="onNextDay">â€º</text>
      </view>
    </view>

    <!-- èŠ‚æ°”ä¿¡æ¯ -->
    <view class="jieqi-section">
      <view class="jieqi-line">
        <text class="jieqi-label">ä¸Šä¸€èŠ‚æ°”:</text>
        <text class="jieqi-value">{{calendarData.jieQi.prev.name}} ({{calendarData.jieQi.prev.time}})</text>
      </view>
      <view class="jieqi-line">
        <text class="jieqi-label">ä¸‹ä¸€èŠ‚æ°”:</text>
        <text class="jieqi-value">{{calendarData.jieQi.next.name}} ({{calendarData.jieQi.next.time}})</text>
      </view>
      <view wx:if="{{calendarData.festival.daysToSpringFestival > 0}}" class="festival-line">
        è·ç¦» æ˜¥èŠ‚ è¿˜æœ‰ {{calendarData.festival.daysToSpringFestival}} å¤©
      </view>
    </view>

    <!-- å®œå¿ŒåŒºåŸŸ -->
    <view class="yiji-section">
      <view class="yiji-left">
        <view class="yiji-header yi-header">å®œ</view>
        <view class="yiji-content">
          <text wx:for="{{calendarData.yiJi.yi}}" wx:key="index" class="yiji-item">{{item}}</text>
        </view>
      </view>
      <view class="yiji-right">
        <view class="yiji-header ji-header">å¿Œ</view>
        <view class="yiji-content">
          <text wx:for="{{calendarData.yiJi.ji}}" wx:key="index" class="yiji-item">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- å†²ç…åŒºåŸŸ -->
    <view class="chongsha-section">
      <view class="chongsha-header">å†²</view>
      <view class="chongsha-text">{{calendarData.chongSha.full}}</view>
    </view>

    <!-- æµå¹´æµæœˆæµæ—¥ + å€¼æ—¥æ˜Ÿç¥ -->
    <view class="ganzhi-section">
      <view class="ganzhi-left">
        <view class="ganzhi-title">æµå¹´æµæœˆæµæ—¥</view>
        <view class="ganzhi-content">{{calendarData.ganZhi.full}}</view>
        <view class="wuxing-text">{{calendarData.wuxing.year}}Â·{{calendarData.wuxing.month}}Â·{{calendarData.wuxing.day}}</view>
      </view>
      <view class="ganzhi-right">
        <view class="zhiri-card">
          <view class="zhiri-label">å€¼æ—¥æ˜Ÿç¥</view>
          <view class="zhiri-item">
            <view class="zhiri-key">åäºŒå»ºé™¤</view>
            <view class="zhiri-value">{{calendarData.zhiRiXingShen.zhiRi}}</view>
          </view>
          <view class="zhiri-item">
            <view class="zhiri-key">é»„é»‘é“</view>
            <view class="zhiri-value">{{calendarData.zhiRiXingShen.shiErJianChu}}</view>
          </view>
          <view class="zhiri-item">
            <view class="zhiri-key">å€¼æ—¥ç¥ç…</view>
            <view class="zhiri-value">{{calendarData.zhiRiXingShen.shenSha}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å‰ç¥æ–¹ä½ -->
    <view class="fangwei-section">
      <view class="section-header">
        <text class="section-icon">ğŸ§­</text>
        <text class="section-title">å‰ç¥æ–¹ä½</text>
      </view>
      <view class="fangwei-table">
        <view class="fangwei-row">
          <view class="fangwei-cell">
            <text class="fangwei-label">è´¢ç¥ä½</text>
            <text class="fangwei-value">{{calendarData.jiShenFangWei.caiShen}}</text>
          </view>
          <view class="fangwei-cell">
            <text class="fangwei-label">ç¦ç¥ä½</text>
            <text class="fangwei-value">{{calendarData.jiShenFangWei.fuShen}}</text>
          </view>
        </view>
        <view class="fangwei-row">
          <view class="fangwei-cell">
            <text class="fangwei-label">å–œç¥ä½</text>
            <text class="fangwei-value">{{calendarData.jiShenFangWei.xiShen}}</text>
          </view>
          <view class="fangwei-cell">
            <text class="fangwei-label">é˜³è´µç¥</text>
            <text class="fangwei-value">{{calendarData.jiShenFangWei.yangGuiShen}}</text>
          </view>
        </view>
        <view class="fangwei-row">
          <view class="fangwei-cell fangwei-cell-single">
            <text class="fangwei-label">é˜´è´µç¥</text>
            <text class="fangwei-value">{{calendarData.jiShenFangWei.yinGuiShen}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¶è¾°å‰å‡¶ -->
    <view class="shichen-section">
      <view class="section-header">
        <text class="section-icon">â°</text>
        <text class="section-title">æ—¶è¾°å‰å‡¶</text>
      </view>
      <view class="shichen-grid">
        <view
          wx:for="{{calendarData.shiChen}}"
          wx:key="name"
          class="shichen-card {{currentShiChen === item.name ? 'shichen-current' : ''}} shichen-{{item.jiXiongClass}}"
        >
          <view class="shichen-name">{{item.name}}</view>
          <view class="shichen-time">{{item.time}}</view>
          <view class="shichen-status">{{item.jiXiong}}</view>
        </view>
      </view>
    </view>

    <!-- æ—¶è¾°äº”è¡Œèƒ½é‡ -->
    <view wx:if="{{calendarData.wuxingEnergy}}" class="wuxing-energy-section">
      <view class="section-header">
        <text class="section-icon">âš¡</text>
        <text class="section-title">æ—¶è¾°äº”è¡Œèƒ½é‡</text>
      </view>

      <!-- äº”è¡Œé¢œè‰²å›¾ä¾‹ -->
      <view class="wuxing-legend">
        <view class="legend-item wuxing-jin">é‡‘</view>
        <view class="legend-item wuxing-mu">æœ¨</view>
        <view class="legend-item wuxing-shui">æ°´</view>
        <view class="legend-item wuxing-huo">ç«</view>
        <view class="legend-item wuxing-tu">åœŸ</view>
      </view>

      <!-- æµæ—¥è¡Œï¼ˆç‹¬ç«‹å¡ç‰‡ï¼‰ -->
      <view class="wuxing-liuri-card">
        <!-- æµæ—¥æ ‡é¢˜ -->
        <view class="wuxing-liuri-title">æµæ—¥</view>

        <!-- æµæ—¥æ•°æ®è¡Œ -->
        <view class="wuxing-liuri-row">
          <!-- å¤©å¹² -->
          <view class="wuxing-gan-zhi wuxing-liuri-cell wuxing-{{calendarData.wuxingEnergy.liuri.dayGanWuxingPinyin}}">
            <view class="gan-zhi-text">{{calendarData.wuxingEnergy.liuri.dayGan}}</view>
            <view class="wuxing-text">({{calendarData.wuxingEnergy.liuri.dayGanWuxing}})</view>
          </view>

          <!-- åœ°æ”¯ -->
          <view class="wuxing-gan-zhi wuxing-liuri-cell wuxing-{{calendarData.wuxingEnergy.liuri.dayZhiWuxingPinyin}}">
            <view class="gan-zhi-text">{{calendarData.wuxingEnergy.liuri.dayZhi}}</view>
            <view class="wuxing-text">({{calendarData.wuxingEnergy.liuri.dayZhiWuxing}})</view>
          </view>

          <!-- è—å¹² -->
          <view
            wx:for="{{calendarData.wuxingEnergy.liuri.cangGan}}"
            wx:key="type"
            class="wuxing-canggan wuxing-liuri-cell wuxing-{{item.wuxingPinyin}}"
          >
            <view class="canggan-text">{{item.gan}}</view>
            <view class="percent-text">{{item.percent}}%</view>
          </view>

          <!-- å¡«å……ç©ºåˆ— -->
          <view wx:if="{{calendarData.wuxingEnergy.liuri.cangGan.length < 3}}" class="wuxing-canggan wuxing-liuri-cell wuxing-empty">
            <view class="canggan-text">â€”</view>
            <view class="percent-text"></view>
          </view>
          <view wx:if="{{calendarData.wuxingEnergy.liuri.cangGan.length < 2}}" class="wuxing-canggan wuxing-liuri-cell wuxing-empty">
            <view class="canggan-text">â€”</view>
            <view class="percent-text"></view>
          </view>
        </view>
      </view>

      <!-- æ—¶è¾°è¡¨æ ¼ -->
      <view class="wuxing-table">
        <!-- æ ‡é¢˜è¡Œ -->
        <view class="wuxing-row wuxing-title-row">
          <view class="wuxing-title-cell wuxing-title-shichen">æ—¶è¾°</view>
          <view class="wuxing-title-cell wuxing-title-canggan">åœ°æ”¯è—å¹²</view>
        </view>

        <!-- è¡¨å¤´è¡Œ -->
        <view class="wuxing-row wuxing-header-row">
          <view class="wuxing-cell wuxing-cell-header wuxing-header-shichen">å¤©å¹²</view>
          <view class="wuxing-cell wuxing-cell-header wuxing-header-shichen">åœ°æ”¯</view>
          <view class="wuxing-cell wuxing-cell-header wuxing-header-canggan">ä¸»æ°”</view>
          <view class="wuxing-cell wuxing-cell-header wuxing-header-canggan">ä¸­æ°”</view>
          <view class="wuxing-cell wuxing-cell-header wuxing-header-canggan">ä½™æ°”</view>
        </view>

        <!-- 12ä¸ªæ—¶è¾°è¡Œ -->
        <view
          wx:for="{{calendarData.wuxingEnergy.shiChen}}"
          wx:key="name"
          class="wuxing-row wuxing-shichen-row {{item.name === currentShiChen ? 'wuxing-shichen-current' : ''}}"
          data-jixiong="{{item.jiXiong}}"
        >
          <view class="wuxing-gan-zhi wuxing-shichen-col wuxing-{{item.tianganWuxingPinyin}}">
            <view class="gan-zhi-text">{{item.tiangan}}</view>
            <view class="wuxing-text">({{item.tianganWuxing}})</view>
          </view>
          <view class="wuxing-gan-zhi wuxing-shichen-col wuxing-{{item.dizhiWuxingPinyin}}">
            <view class="gan-zhi-text">{{item.dizhi}}</view>
            <view class="wuxing-text">({{item.dizhiWuxing}})</view>
          </view>
          <view
            wx:for="{{item.cangGan}}"
            wx:for-item="cg"
            wx:for-index="cgIndex"
            wx:key="type"
            class="wuxing-canggan wuxing-canggan-col wuxing-{{cg.wuxingPinyin}}"
          >
            <view class="canggan-text">{{cg.gan}}</view>
            <view class="percent-text">{{cg.percent}}%</view>
          </view>
          <!-- å¡«å……ç©ºåˆ— -->
          <view wx:if="{{item.cangGan.length < 3}}" class="wuxing-canggan wuxing-canggan-col wuxing-empty">
            <view class="canggan-text">â€”</view>
            <view class="percent-text"></view>
          </view>
          <view wx:if="{{item.cangGan.length < 2}}" class="wuxing-canggan wuxing-canggan-col wuxing-empty">
            <view class="canggan-text">â€”</view>
            <view class="percent-text"></view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
