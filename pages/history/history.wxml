<!--pages/history/history.wxml-->
<view class="container">
  <view class="header">
    <text class="title">æˆ‘çš„æŠ¥å‘Š</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-icon"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æŠ¥å‘Šåˆ—è¡¨ -->
  <view wx:else class="report-list">
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{reports.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— æŠ¥å‘Šè®°å½•</text>
      <button class="empty-btn" bindtap="onGoHome">ç«‹å³æµ‹ç®—</button>
    </view>

    <!-- æŠ¥å‘Šå¡ç‰‡åˆ—è¡¨ -->
    <view wx:else>
      <view
        class="report-card"
        wx:for="{{reports}}"
        wx:key="id"
        bindtap="onCardTap"
        data-report="{{item}}"
      >
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header">
          <view class="name-gender">
            <text class="name">{{item.name}}</text>
            <text class="type-badge {{item.reportType === 'fortune2026' ? 'fortune2026' : 'basic'}}">
              [{{item.buttonText || 'äº”è¡Œåˆ†æ'}}]
            </text>
            <text class="gender">{{item.gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
          </view>
          <view class="status-badge {{item.status === 'published' ? 'completed' : 'incomplete'}}">
            {{item.status === 'published' ? 'å®Œæˆ' : 'æœªå®Œæˆ'}}
          </view>
        </view>

        <!-- å¡ç‰‡å†…å®¹ -->
        <view class="card-content">
          <view class="info-row">
            <text class="label">å‡ºç”Ÿæ—¶é—´ï¼š</text>
            <text class="value">{{item.birthDate}} {{item.birthTime}}</text>
          </view>
          <view class="info-row">
            <text class="label">å‡ºç”Ÿåœ°ç‚¹ï¼š</text>
            <text class="value">{{item.city}}</text>
          </view>
        </view>

        <!-- å¡ç‰‡åº•éƒ¨ -->
        <view class="card-footer">
          <text class="bazi-preview">{{item.baziYear}} {{item.baziMonth}} {{item.baziDay}} {{item.baziHour}}</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
    </view>
  </view>
</view>
